% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Uncertainty.R
\name{mc_uncertainty}
\alias{mc_uncertainty}
\title{Monte Carlo Uncertainty Propagation}
\usage{
mc_uncertainty(
  fn,
  inputs,
  N = 1000,
  corr_matrix = NULL,
  conf = 0.9,
  seed = 42,
  decompose = FALSE,
  extra_args = list()
)
}
\arguments{
\item{fn}{A function that computes the biomass/carbon estimate.
Must accept named arguments matching the names in \code{inputs}.}

\item{inputs}{A named list where each element is itself a list with:
\describe{
\item{mean}{Central value (required)}
\item{sd}{Standard deviation (required)}
\item{dist}{Distribution type: "normal" (default), "lognormal", "uniform"}
\item{source}{Uncertainty source label: "measurement", "parameter",
"residual", "other"}
}}

\item{N}{Number of Monte Carlo samples (default: 1000). Higher values give
more stable estimates but take longer. Recommended: 1000 for quick checks,
10000 for final results.}

\item{corr_matrix}{Optional correlation matrix for inputs. If NULL, inputs
are assumed independent.}

\item{conf}{Confidence level for intervals (default: 0.90 for 0.5-0.95).}

\item{seed}{Random seed for reproducibility. Set to NULL for no seed.}

\item{decompose}{Logical. If TRUE, also compute variance decomposition by
uncertainty source. Default FALSE.}

\item{extra_args}{Named list of additional fixed arguments to pass to fn.}
}
\value{
An S3 object of class "mc_uncertainty" containing:
\describe{
\item{estimate}{Point estimate (mean of simulations)}
\item{median}{Median of simulations (often better for skewed distributions)}
\item{sd}{Standard deviation of simulations}
\item{cv}{Coefficient of variation (percent)}
\item{ci_low}{Lower confidence bound}
\item{ci_high}{Upper confidence bound}
\item{conf}{Confidence level used}
\item{skewness}{Distribution skewness (0 = symmetric)}
\item{kurtosis}{Distribution kurtosis (3 = normal)}
\item{samples}{All simulation samples (for custom analysis)}
\item{n_samples}{Number of valid samples used}
\item{inputs_summary}{Summary of input distributions}
\item{decomposition}{Variance decomposition by source (if decompose=TRUE)}
}
}
\description{
Propagates multiple sources of uncertainty through allometric fn
using Monte Carlo simulation. Reports comprehensive uncertainty statistics
including median, quantile intervals, and distribution shape metrics.

\itemize{
\item Captures non-linear effects that first-order approximations miss
\item Handles correlated inputs
\item Reports asymmetric uncertainty (common in log-transformed allometries)
\item Allows decomposition of uncertainty by source
}
}
\details{
\strong{Uncertainty Sources:}
\enumerate{
\item \strong{Measurement error}: Uncertainty in field measurements
(DBH typically +/- 1-5 mm, height +/- 0.5-2 m)
\item \strong{Parameter uncertainty}: Uncertainty in allometric equation
coefficients (from regression standard errors)
\item \strong{Residual error}: Prediction error of the allometric model
(from model RSE/RMSE)
\item \strong{Method choice}: Variation across different allometric methods
}

\strong{Interpretation Guidelines:}

\itemize{
\item CV < 10 percent: Low uncertainty, estimates reliable
\item CV 10-30 percent: Moderate uncertainty, typical for field data
\item CV > 30 percent: High uncertainty, interpret with caution
\item Absolute skewness > 1: Highly asymmetric, use median not mean
}
}
\examples{
# Simple example: Bunce equation with measurement + parameter uncertainty
bunce_fn <- function(dbh, a, b) {
  exp(a + b * log(pi * dbh))
}

inputs <- list(
  dbh = list(mean = 30, sd = 0.75, source = "measurement"),
  a = list(mean = 1.868, sd = 0.047, source = "parameter"),
  b = list(mean = 2.268, sd = 0.057, source = "parameter")
)

result <- mc_uncertainty(bunce_fn, inputs, N = 1000, decompose = TRUE)
print(result)
summary(result)

# With lognormal distribution for DBH (accounts for positive constraint)
inputs_ln <- list(
  dbh = list(mean = 30, sd = 2, dist = "lognormal", source = "measurement"),
  a = list(mean = 1.868, sd = 0.047, source = "parameter"),
  b = list(mean = 2.268, sd = 0.057, source = "parameter")
)
result_ln <- mc_uncertainty(bunce_fn, inputs_ln, N = 1000)

}
\references{
\itemize{
\item Chave, J. et al. (2004). Error propagation and scaling for tropical
forest biomass estimates. Phil. Trans. R. Soc. Lond. B 359, 409-420.
\item Molto, Q. et al. (2013). Error propagation in biomass estimation in
tropical forests. Methods in Ecology and Evolution 4, 175-183.
}
}
