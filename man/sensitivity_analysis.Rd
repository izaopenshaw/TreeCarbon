% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Sensitivity.R
\name{sensitivity_analysis}
\alias{sensitivity_analysis}
\title{Sensitivity Analysis: How Sensitive is Carbon to Method Choice?}
\usage{
sensitivity_analysis(
  data,
  methods = c("WCC", "BIOMASS", "allodb", "Bunce"),
  returnv = "AGC",
  coords = NULL,
  type = "broadleaf",
  method = "IPCC2",
  biome = "temperate",
  aggregate = TRUE,
  reference = "WCC"
)
}
\arguments{
\item{data}{Either:
\itemize{
\item A data frame output from \code{allometries()} containing columns
like \code{WCC_C_t}, \code{biomass_C_t}, etc.
\item A data frame with tree measurements (dbh, height, genus, species)
for calculating estimates internally
}}

\item{methods}{Character vector of methods to compare. Default:
\code{c("WCC", "BIOMASS", "allodb", "Bunce")}. Must match column prefixes
in allometries output (e.g., "WCC" matches "WCC_C_t").}

\item{returnv}{Character. "AGC" for carbon or "AGB" for biomass. Only used
when detecting columns from allometries output. Default "AGC".}

\item{coords}{Coordinates for BIOMASS/allodb (longitude, latitude).
Only required if \code{data} is raw tree data.}

\item{type}{Tree type: "broadleaf" or "conifer". Only used if \code{data}
is raw tree data. Default "broadleaf".}

\item{method}{Carbon conversion method (Thomas, IPCC2, etc.). Only used if
\code{data} is raw tree data. Default "IPCC2".}

\item{biome}{Biome for carbon conversion. Only used if \code{data} is raw
tree data. Default "temperate".}

\item{aggregate}{Logical. If TRUE, returns plot-level sensitivity. If FALSE,
returns per-tree sensitivity. Default TRUE.}

\item{reference}{Reference method for percent difference calculations.
Default "WCC".}
}
\value{
An S3 object of class "sensitivity_analysis" containing:
\describe{
\item{method_summary}{Data frame with per-method totals and rankings}
\item{by_tree}{Per-tree estimates from each method}
\item{sensitivity_metrics}{Key sensitivity indicators (CV, spread, etc.)}
\item{sensitivity_level}{Interpretation level (LOW/MODERATE/HIGH/VERY HIGH)}
\item{interpretation}{Plain-language interpretation}
\item{recommendation}{Suggested actions based on sensitivity}
}
}
\description{
Quantifies how sensitive carbon/biomass estimates are to the choice of
allometric method. This helps answer the question: "How much does my
reported carbon change depending on which method I use?"

This function can accept either:
\itemize{
\item Output from \code{allometries()} directly (recommended for consistency)
\item Raw tree data (for backward compatibility)
}
}
\details{
\strong{Recommended Usage:}
For consistent results, first run \code{allometries()} with your desired
parameters, then pass that output to \code{sensitivity_analysis()}:

\preformatted{
results <- allometries(genus, species, dbh, height, method = "IPCC2", ...)
sens <- sensitivity_analysis(results)
}

\strong{Sensitivity Metrics Computed:}
\describe{
\item{range_ratio}{Max / Min estimate (fold difference) - \strong{most robust metric}}
\item{spread_pct}{Spread (max - min) as percentage of mean}
\item{cv}{Coefficient of variation across methods}
\item{spread}{Maximum - minimum estimate across methods (absolute)}
}

\strong{Statistical Note:}
The sensitivity metrics are calculated across the 4 fixed allometric methods
(WCC, BIOMASS, allodb, Bunce). These methods are not random samples from a
population of possible methods - they are specific, commonly-used approaches
selected for their relevance and validation. Therefore:
\itemize{
\item The CV describes "how much these specific methods disagree"
\item It does NOT describe sampling uncertainty from a population of methods
\item The \strong{range_ratio} (max/min) is the most robust metric with n=4 methods,
as it doesn't assume any distribution
\item Adding more methods would increase statistical precision but only if
those methods are equally valid for your application
}

\strong{Interpretation Guidelines:}
\itemize{
\item CV < 0.1: Low sensitivity - method choice has minor impact
\item CV 0.1-0.25: Moderate sensitivity - report range or use ensemble
\item CV 0.25-0.5: High sensitivity - method choice significantly affects results
\item CV > 0.5: Very high sensitivity - investigate cause, consider data quality
}
}
\examples{
\dontrun{
# Recomended: Use allometries() output for consistency
results <- allometries(genus = c("Quercus", "Fagus"), species = c("robur", "sylvatica"),
  dbh = c(45, 38), height = c(18, 15), method = "IPCC2")

sens <- sensitivity_analysis(results)
print(sens)
plot(sens)

# Alternative: Raw tree data (uses defaults for carbon conversion)
tree_data <- data.frame(
  dbh = c(45, 38), height = c(18, 15),
  genus = c("Quercus", "Fagus"),
  species = c("robur", "sylvatica")
)
sens <- sensitivity_analysis(tree_data, coords = c(-0.29, 51.48))
}

}
